---
layout: layouts/base.njk
showMaps: true
---

<!-- Bloc containing the map -->
<div id="map">
    <aside id="map-selection" 
           class="map-panel" 
           aria-labelledby="panel-title">
        <button id="open-panel-btn" 
                class="fr-btn fr-btn--icon-left fr-icon-eye-line map-panel-toggle" 
                aria-label="Ouvrir le panneau de sélection des cartes"
                aria-controls="control-panel"
                aria-expanded="true">
            Afficher les cartes
        </button>
        <div class="map-panel--extended">
            <div class="map-panel__header fr-mx-2w fr-mt-2w">
                <button class="fr-btn--close fr-btn" 
                        aria-label="Fermer le panneau de sélection des cartes"
                        aria-controls="control-panel">
                    Fermer
                </button>
            </div>
            <div class="map-panel__content fr-px-2w fr-pb-4w">
                <div class="map-panel__styles-list">
                    <h2 id="panel-title" class="fr-h5">Cartes</h2>
                    {% if mapStyles and mapStyles.styles %}
                        <div class="map-card-grid">
                            {% for style in mapStyles.styles %}
                                <div class="map-card fr-card--shadow" 
                                    data-style-url="{{ style.url }}"
                                    data-style-title="{{ style.title }}"
                                    data-style-description="{{ style.description }}"
                                    data-style-attribution="{{ style.attribution }}"
                                    data-style-version="{{ style.version }}"
                                    {% if style.isDefault %}aria-current="true"{% endif %}
                                    role="option">
                                    <div class="map-card__header">
                                        <span class="fr-icon-success-fill" aria-hidden="true"></span>
                                        <div class="map-card__img">   
                                            <img src="{{ style.thumbnail }}" class="fr-responsive-img" alt="Aperçu de {{ style.title }}" />
                                        </div>
                                    </div>
                                    <div class="map-card__content fr-py-1w fr-px-3v">
                                        <h3 class="map-card__title fr-mb-0">{{ style.title }}</h3>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No map styles available</p>
                    {% endif %}
                </div>
                <div class="map-panel__style-details" style="display: none;">
                    <button class="fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-btn--icon-left fr-icon-arrow-left-line fr-mb-2w" id="back-to-list">
                        Retour à la liste
                    </button>
                    <h2 class="fr-h5 fr-mb-2w" id="style-title"></h2>
                    <div class="map-card__img" alt="">   
                        <img id="style-thumbnail" class="fr-responsive-img" alt="Aperçu de {{ style.title }}" />
                    </div>
                    <p id="style-description" class="fr-text--sm"></p>
                    {# <p id="style-attribution" class="fr-text--xs fr-mb-0"></p> #}
                    <button class="fr-btn" id="apply-style">
                        Appliquer ce style
                    </button>
                    <p class="fr-text--xs">Version : <span id="style-version"></span></p>
                </div>
            </div>
        </div>
    </aside>
    {# <div class="map-panel">
        <p id="zoom-level"></p>
    </div> #}
</div>
<script>
    window.defaultMapStyle = {% if mapStyles and mapStyles.styles %}
        {% set defaultStyle = mapStyles.styles | find("isDefault", true) %}
        {% if defaultStyle %}'{{ defaultStyle.url }}'{% else %}null{% endif %}
    {% else %}null{% endif %};
</script>
<script type="text/javascript" src="/js/maps-viewer.js"></script>